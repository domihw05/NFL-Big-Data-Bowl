---
title: "NFL Data Bowl Practice"
author: "Dominic Hoar-Weiler"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
#Click to clear environment
rm(list = ls())
```

#Importing Data

```{r}
library(tidyverse)
player_raw_data <- read_csv("players.csv")
plays_raw_data <- read_csv("plays.csv")
games_raw_data <- read_csv("games.csv")

tracking1_raw <- read_csv("tracking_week_1.csv")
tracking2_raw <- read_csv("tracking_week_2.csv")
tracking3_raw <- read_csv("tracking_week_3.csv")
tracking4_raw <- read_csv("tracking_week_4.csv")
tracking5_raw <- read_csv("tracking_week_5.csv")
tracking6_raw <- read_csv("tracking_week_6.csv")
tracking7_raw <- read_csv("tracking_week_7.csv")
tracking8_raw <- read_csv("tracking_week_8.csv")
tracking9_raw <- read_csv("tracking_week_9.csv")
```

#Exploring the Data

```{r}

# Calculate average weight by college, sort in descending order, and select top 5
info_by_college <- player_raw_data |>
                    group_by(collegeName) |>
                    summarize(num_players = n(),
                              weight = mean(weight)) |>
                    filter(num_players > 10) |>
                    arrange(-weight) |>
                    filter(weight > 250)

print(info_by_college)

ggplot(data = info_by_college,
       aes(x = weight,y=reorder(collegeName,+weight))) + 
       geom_bar(stat = "identity",fill ="steelblue") +
       theme_minimal() +
        labs(x = "Weight",
            y = "College")

```

```{r}
sorted_4th_down <- plays_raw_data |>
                   filter(down == 4)  |>
                   mutate(firstDown = yardsGained >= yardsToGo) |>
                   group_by(possessionTeam) |>
                   summarize(num_plays = n(),
                             firstDowns = sum(firstDown,na.rm = TRUE)) |>
                   mutate(firstDownConversionPctg = (firstDowns/num_plays)*100) |>
                   arrange(-firstDownConversionPctg) |>
                   mutate(firstDownConversionPctg = paste0(round(firstDownConversionPctg,2),'%')) 
                   

print(sorted_4th_down)
```


```{r}
lm.yardsByPlayClock <- lm(yardsGained ~ pff_passCoverage,plays_raw_data)

summary(lm.yardsByPlayClock)
```


#Nathan's Work

```{r}
#Testing quantitative variables: down, yardsToGo, offensiveFormation, recieverAlignment 
# Drop rows with missing values in key columns
plays_clean <- plays_raw_data %>%
  filter(
    !is.na(yardsGained),           
    !is.na(down),                 
    !is.na(yardsToGo),            
    !is.na(receiverAlignment)   
  )

# Linear regression with pre-snap variables
model_pre_snap <- lm(yardsGained ~ yardlineSide + down + yardsToGo, data = plays_clean)

# Summary of the model
summary(model_pre_snap)
```
```{r}
#cleaning for offensiveFormation for ANOVA test 
plays_clean <- plays_clean %>%
  filter(offenseFormation != "EMPTY")

# Boxplot after cleaning
plays_clean %>%
  ggplot(aes(x = offenseFormation, y = yardsGained)) +
  geom_boxplot() +
  labs(
    title = "Distribution of Yards Gained by Offensive Formation (Excluding EMPTY)",
    x = "Offensive Formation",
    y = "Yards Gained"
  ) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

# ANOVA after cleaning
anova_model <- aov(yardsGained ~ offenseFormation, data = plays_clean)
summary(anova_model)

TukeyHSD(anova_model) #trying to see which ones difer the most


# Calculate mean yards gained by formation
formation_means <- plays_clean %>%
  group_by(offenseFormation) %>%
  summarize(
    mean_yards = mean(yardsGained, na.rm = TRUE),
    count = n()
  ) %>%
  arrange(desc(mean_yards)) 

formation_means

# Bar plot of mean yards gained by formation
formation_means %>%
  ggplot(aes(x = reorder(offenseFormation, mean_yards), y = mean_yards)) +
  geom_bar(stat = "identity", fill = "steelblue") +
  labs(
    title = "Mean Yards Gained by Offensive Formation",
    x = "Offensive Formation",
    y = "Mean Yards Gained"
  ) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

```
```{r}
# Group by receiver alignment and calculate mean yards gained
alignment_stats <- plays_clean %>%
  group_by(receiverAlignment) %>%
  summarize(
    mean_yards = mean(yardsGained, na.rm = TRUE),
    count = n()
  ) %>%
  arrange(desc(mean_yards))

# View the summary stats
alignment_stats

# Boxplot for yards gained by receiver alignment
plays_clean %>%
  ggplot(aes(x = receiverAlignment, y = yardsGained)) +
  geom_boxplot() +
  labs(
    title = "Impact of Receiver Alignment on Yards Gained",
    x = "Receiver Alignment",
    y = "Yards Gained"
  ) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

# ANOVA test for receiver alignment
anova_alignment <- aov(yardsGained ~ receiverAlignment, data = plays_clean)
summary(anova_alignment)


```
```{r}
tukey_alignment <- TukeyHSD(anova_alignment)
tukey_alignment
```
